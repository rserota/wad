/*! wad 2015-11-10 */
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Wad=b()}):"object"==typeof exports?module.exports=b():a.Wad=b()}(this,function(){!function(a){var b="recorderWorker.js",c=function(a,c){var d=c||{},e=d.bufferLen||4096,f=d.numChannels||2;this.context=a.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,e,f,f);var g=new Worker(d.workerPath||b);g.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:f}});var h,i=!1;this.node.onaudioprocess=function(a){if(i){for(var b=[],c=0;f>c;c++)b.push(a.inputBuffer.getChannelData(c));g.postMessage({command:"record",buffer:b})}},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(d[b]=a[b])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){g.postMessage({command:"clear"})},this.getBuffer=function(a){h=a||d.callback,g.postMessage({command:"getBuffer"})},this.exportWAV=function(a,b){if(h=a||d.callback,b=b||d.type||"audio/wav",!h)throw new Error("Callback not set");g.postMessage({command:"exportWAV",type:b})},g.onmessage=function(a){var b=a.data;h(b)},a.connect(this.node),this.node.connect(this.context.destination)};c.forceDownload=function(b,c){var d=(a.URL||a.webkitURL).createObjectURL(b),e=a.document.createElement("a");e.href=d,e.download=c||"output.wav";var f=document.createEvent("Event");f.initEvent("click",!0,!0),e.dispatchEvent(f)},a.Recorder=c}(window),function(a){function b(){return c}function c(b){if(!(this instanceof c))return new c(b);if(a.AudioContext||(a.AudioContext=a.webkitAudioContext),b||(console.log("tuna.js: Missing audio context! Creating a new context for you."),b=a.AudioContext&&new a.AudioContext),!b)throw new Error("Tuna cannot initialize because this environment does not support web audio.");d(b),j=b,k=this}function d(a){function b(){var a=Array.prototype.shift.apply(arguments);return a=m.isPrototypeOf?m.isPrototypeOf(a)?a.input:a:a.input||a,arguments=Array.prototype.slice.call(arguments),arguments.unshift(a),e.apply(this,arguments),a}if(a.__connectified__!==!0){var c=a.createGain(),d=Object.getPrototypeOf(Object.getPrototypeOf(c)),e=d.connect;d.connect=b,a.__connectified__=!0}}function e(a){return Math.max(0,Math.round(100*Math.pow(2,a/6))/100)}function f(a,b){var c,d,e=0,f=0,g=0,h=0;return c=a.toExponential().match(/^.\.?(.*)e(.+)$/),e=parseInt(c[2],10)-(c[1]+"").length,c=b.toExponential().match(/^.\.?(.*)e(.+)$/),f=parseInt(c[2],10)-(c[1]+"").length,f>e&&(e=f),d=a%b,-100>e||e>20?(g=Math.round(Math.log(d)/Math.log(10)),h=Math.pow(10,g),(d/h).toFixed(g-e)*h):parseFloat(d.toFixed(-e))}function g(a){return 0===a?1:Math.abs(a)/a}function h(a){return(Math.exp(a)-Math.exp(-a))/(Math.exp(a)+Math.exp(-a))}function i(a,b){return void 0===a?b:a}var j,k,l=function(a,b){a.value=b},m=Object.create(null,{activate:{writable:!0,value:function(a){a?(this.input.disconnect(),this.input.connect(this.activateNode),this.activateCallback&&this.activateCallback(a)):(this.input.disconnect(),this.input.connect(this.output))}},bypass:{get:function(){return this._bypass},set:function(a){this._lastBypassValue!==a&&(this._bypass=a,this.activate(!a),this._lastBypassValue=a)}},connect:{value:function(a){this.output.connect(a)}},disconnect:{value:function(a){this.output.disconnect(a)}},connectInOrder:{value:function(a){for(var b=a.length-1;b--;){if(!a[b].connect)return console.error("AudioNode.connectInOrder: TypeError: Not an AudioNode.",a[b]);a[b].connect(a[b+1].input?a[b+1].input:a[b+1])}}},getDefaults:{value:function(){var a={};for(var b in this.defaults)a[b]=this.defaults[b].value;return a}},automate:{value:function(a,b,c,d){var e,f=d?~~(d/1e3):j.currentTime,g=c?~~(c/1e3):0,h=this.defaults[a],i=this[a];i?h.automatable?(c?(e="linearRampToValueAtTime",i.cancelScheduledValues(f),i.setValueAtTime(i.value,f)):e="setValueAtTime",i[e](b,g+f)):i=b:console.error("Invalid Property for "+this.name)}}}),n="float",o="boolean",p="string",q="int";"undefined"!=typeof module&&module.exports?module.exports=c:"function"==typeof define?a.define("Tuna",b):a.Tuna=c,c.prototype.Bitcrusher=function(a){a||(a=this.getDefaults()),this.bufferSize=a.bufferSize||this.defaults.bufferSize.value,this.input=j.createGain(),this.activateNode=j.createGain(),this.processor=j.createScriptProcessor(this.bufferSize,1,1),this.output=j.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var b,c,d,e,f,g=0,h=0;this.processor.onaudioprocess=function(a){for(b=a.inputBuffer.getChannelData(0),c=a.outputBuffer.getChannelData(0),d=Math.pow(.5,this.bits),f=b.length,e=0;f>e;e++)g+=this.normfreq,g>=1&&(g-=1,h=d*Math.floor(b[e]/d+.5)),c[e]=h},this.bits=a.bits||this.defaults.bits.value,this.normfreq=i(a.normfreq,this.defaults.normfreq.value),this.bypass=a.bypass||!1},c.prototype.Bitcrusher.prototype=Object.create(m,{name:{value:"Bitcrusher"},defaults:{writable:!0,value:{bits:{value:4,min:1,max:16,automatable:!1,type:q},bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:q},bypass:{value:!1,automatable:!1,type:o},normfreq:{value:.1,min:1e-4,max:1,automatable:!1,type:n}}},bits:{enumerable:!0,get:function(){return this.processor.bits},set:function(a){this.processor.bits=a}},normfreq:{enumerable:!0,get:function(){return this.processor.normfreq},set:function(a){this.processor.normfreq=a}}}),c.prototype.Cabinet=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.convolver=this.newConvolver(a.impulsePath||"../impulses/impulse_guitar.wav"),this.makeupNode=j.createGain(),this.output=j.createGain(),this.activateNode.connect(this.convolver.input),this.convolver.output.connect(this.makeupNode),this.makeupNode.connect(this.output),this.makeupGain=i(a.makeupGain,this.defaults.makeupGain),this.bypass=a.bypass||!1},c.prototype.Cabinet.prototype=Object.create(m,{name:{value:"Cabinet"},defaults:{writable:!0,value:{makeupGain:{value:1,min:0,max:20,automatable:!0,type:n},bypass:{value:!1,automatable:!1,type:o}}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(a){this.makeupNode.gain.value=a}},newConvolver:{value:function(a){return new k.Convolver({impulse:a,dryLevel:0,wetLevel:1})}}}),c.prototype.Chorus=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.attenuator=this.activateNode=j.createGain(),this.splitter=j.createChannelSplitter(2),this.delayL=j.createDelay(),this.delayR=j.createDelay(),this.feedbackGainNodeLR=j.createGain(),this.feedbackGainNodeRL=j.createGain(),this.merger=j.createChannelMerger(2),this.output=j.createGain(),this.lfoL=new k.LFO({target:this.delayL.delayTime,callback:l}),this.lfoR=new k.LFO({target:this.delayR.delayTime,callback:l}),this.input.connect(this.attenuator),this.attenuator.connect(this.output),this.attenuator.connect(this.splitter),this.splitter.connect(this.delayL,0),this.splitter.connect(this.delayR,1),this.delayL.connect(this.feedbackGainNodeLR),this.delayR.connect(this.feedbackGainNodeRL),this.feedbackGainNodeLR.connect(this.delayR),this.feedbackGainNodeRL.connect(this.delayL),this.delayL.connect(this.merger,0,0),this.delayR.connect(this.merger,0,1),this.merger.connect(this.output),this.feedback=i(a.feedback,this.defaults.feedback.value),this.rate=i(a.rate,this.defaults.rate.value),this.delay=i(a.delay,this.defaults.delay.value),this.depth=i(a.depth,this.defaults.depth.value),this.lfoR.phase=Math.PI/2,this.attenuator.gain.value=.6934,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=a.bypass||!1},c.prototype.Chorus.prototype=Object.create(m,{name:{value:"Chorus"},defaults:{writable:!0,value:{feedback:{value:.4,min:0,max:.95,automatable:!1,type:n},delay:{value:.0045,min:0,max:1,automatable:!1,type:n},depth:{value:.7,min:0,max:1,automatable:!1,type:n},rate:{value:1.5,min:0,max:8,automatable:!1,type:n},bypass:{value:!1,automatable:!1,type:o}}},delay:{enumerable:!0,get:function(){return this._delay},set:function(a){this._delay=4e-4*Math.pow(10,a),this.lfoL.offset=this._delay,this.lfoR.offset=this._delay,this._depth=this._depth}},depth:{enumerable:!0,get:function(){return this._depth},set:function(a){this._depth=a,this.lfoL.oscillation=this._depth*this._delay,this.lfoR.oscillation=this._depth*this._delay}},feedback:{enumerable:!0,get:function(){return this._feedback},set:function(a){this._feedback=a,this.feedbackGainNodeLR.gain.value=this._feedback,this.feedbackGainNodeRL.gain.value=this._feedback}},rate:{enumerable:!0,get:function(){return this._rate},set:function(a){this._rate=a,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}}}),c.prototype.Compressor=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.compNode=this.activateNode=j.createDynamicsCompressor(),this.makeupNode=j.createGain(),this.output=j.createGain(),this.compNode.connect(this.makeupNode),this.makeupNode.connect(this.output),this.automakeup=i(a.automakeup,this.defaults.automakeup.value),this.makeupGain=a.makeupGain||this.defaults.makeupGain.value,this.threshold=i(a.threshold,this.defaults.threshold.value),this.release=a.release||this.defaults.release.value,this.attack=i(a.attack,this.defaults.attack.value),this.ratio=a.ratio||this.defaults.ratio.value,this.knee=i(a.knee,this.defaults.knee.value),this.bypass=a.bypass||!1},c.prototype.Compressor.prototype=Object.create(m,{name:{value:"Compressor"},defaults:{writable:!0,value:{threshold:{value:-20,min:-60,max:0,automatable:!0,type:n},release:{value:250,min:10,max:2e3,automatable:!0,type:n},makeupGain:{value:1,min:1,max:100,automatable:!0,type:n},attack:{value:1,min:0,max:1e3,automatable:!0,type:n},ratio:{value:4,min:1,max:50,automatable:!0,type:n},knee:{value:5,min:0,max:40,automatable:!0,type:n},automakeup:{value:!1,automatable:!1,type:o},bypass:{value:!1,automatable:!1,type:o}}},computeMakeup:{value:function(){var a=4,b=this.compNode;return-(b.threshold.value-b.threshold.value/b.ratio.value)/a}},automakeup:{enumerable:!0,get:function(){return this._automakeup},set:function(a){this._automakeup=a,this._automakeup&&(this.makeupGain=this.computeMakeup())}},threshold:{enumerable:!0,get:function(){return this.compNode.threshold},set:function(a){this.compNode.threshold.value=a,this._automakeup&&(this.makeupGain=this.computeMakeup())}},ratio:{enumerable:!0,get:function(){return this.compNode.ratio},set:function(a){this.compNode.ratio.value=a,this._automakeup&&(this.makeupGain=this.computeMakeup())}},knee:{enumerable:!0,get:function(){return this.compNode.knee},set:function(a){this.compNode.knee.value=a,this._automakeup&&(this.makeupGain=this.computeMakeup())}},attack:{enumerable:!0,get:function(){return this.compNode.attack},set:function(a){this.compNode.attack.value=a/1e3}},release:{enumerable:!0,get:function(){return this.compNode.release},set:function(a){this.compNode.release=a/1e3}},makeupGain:{enumerable:!0,get:function(){return this.makeupNode.gain},set:function(a){this.makeupNode.gain.value=e(a)}}}),c.prototype.Convolver=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.convolver=j.createConvolver(),this.dry=j.createGain(),this.filterLow=j.createBiquadFilter(),this.filterHigh=j.createBiquadFilter(),this.wet=j.createGain(),this.output=j.createGain(),this.activateNode.connect(this.filterLow),this.activateNode.connect(this.dry),this.filterLow.connect(this.filterHigh),this.filterHigh.connect(this.convolver),this.convolver.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.dryLevel=i(a.dryLevel,this.defaults.dryLevel.value),this.wetLevel=i(a.wetLevel,this.defaults.wetLevel.value),this.highCut=a.highCut||this.defaults.highCut.value,this.buffer=a.impulse||"../impulses/ir_rev_short.wav",this.lowCut=a.lowCut||this.defaults.lowCut.value,this.level=i(a.level,this.defaults.level.value),this.filterHigh.type="lowpass",this.filterLow.type="highpass",this.bypass=a.bypass||!1},c.prototype.Convolver.prototype=Object.create(m,{name:{value:"Convolver"},defaults:{writable:!0,value:{highCut:{value:22050,min:20,max:22050,automatable:!0,type:n},lowCut:{value:20,min:20,max:22050,automatable:!0,type:n},dryLevel:{value:1,min:0,max:1,automatable:!0,type:n},wetLevel:{value:1,min:0,max:1,automatable:!0,type:n},level:{value:1,min:0,max:1,automatable:!0,type:n}}},lowCut:{get:function(){return this.filterLow.frequency},set:function(a){this.filterLow.frequency.value=a}},highCut:{get:function(){return this.filterHigh.frequency},set:function(a){this.filterHigh.frequency.value=a}},level:{get:function(){return this.output.gain},set:function(a){this.output.gain.value=a}},dryLevel:{get:function(){return this.dry.gain},set:function(a){this.dry.gain.value=a}},wetLevel:{get:function(){return this.wet.gain},set:function(a){this.wet.gain.value=a}},buffer:{enumerable:!1,get:function(){return this.convolver.buffer},set:function(a){var b=this.convolver,c=new XMLHttpRequest;return a?(c.open("GET",a,!0),c.responseType="arraybuffer",c.onreadystatechange=function(){4===c.readyState&&(c.status<300&&c.status>199||302===c.status)&&j.decodeAudioData(c.response,function(a){b.buffer=a},function(a){a&&console.log("Tuna.Convolver.setBuffer: Error decoding data"+a)})},void c.send(null)):void console.log("Tuna.Convolver.setBuffer: Missing impulse path!")}}}),c.prototype.Delay=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.dry=j.createGain(),this.wet=j.createGain(),this.filter=j.createBiquadFilter(),this.delay=j.createDelay(),this.feedbackNode=j.createGain(),this.output=j.createGain(),this.activateNode.connect(this.delay),this.activateNode.connect(this.dry),this.delay.connect(this.filter),this.filter.connect(this.feedbackNode),this.feedbackNode.connect(this.delay),this.feedbackNode.connect(this.wet),this.wet.connect(this.output),this.dry.connect(this.output),this.delayTime=a.delayTime||this.defaults.delayTime.value,this.feedback=i(a.feedback,this.defaults.feedback.value),this.wetLevel=i(a.wetLevel,this.defaults.wetLevel.value),this.dryLevel=i(a.dryLevel,this.defaults.dryLevel.value),this.cutoff=a.cutoff||this.defaults.cutoff.value,this.filter.type="lowpass",this.bypass=a.bypass||!1},c.prototype.Delay.prototype=Object.create(m,{name:{value:"Delay"},defaults:{writable:!0,value:{delayTime:{value:100,min:20,max:1e3,automatable:!1,type:n},feedback:{value:.45,min:0,max:.9,automatable:!0,type:n},cutoff:{value:2e4,min:20,max:2e4,automatable:!0,type:n},wetLevel:{value:.5,min:0,max:1,automatable:!0,type:n},dryLevel:{value:1,min:0,max:1,automatable:!0,type:n}}},delayTime:{enumerable:!0,get:function(){return this.delay.delayTime},set:function(a){this.delay.delayTime.value=a/1e3}},wetLevel:{enumerable:!0,get:function(){return this.wet.gain},set:function(a){this.wet.gain.value=a}},dryLevel:{enumerable:!0,get:function(){return this.dry.gain},set:function(a){this.dry.gain.value=a}},feedback:{enumerable:!0,get:function(){return this.feedbackNode.gain},set:function(a){this.feedbackNode.gain.value=a}},cutoff:{enumerable:!0,get:function(){return this.filter.frequency},set:function(a){this.filter.frequency.value=a}}}),c.prototype.Filter=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.filter=j.createBiquadFilter(),this.output=j.createGain(),this.activateNode.connect(this.filter),this.filter.connect(this.output),this.frequency=a.frequency||this.defaults.frequency.value,this.Q=a.resonance||this.defaults.Q.value,this.filterType=i(a.filterType,this.defaults.filterType.value),this.gain=i(a.gain,this.defaults.gain.value),this.bypass=a.bypass||!1},c.prototype.Filter.prototype=Object.create(m,{name:{value:"Filter"},defaults:{writable:!0,value:{frequency:{value:800,min:20,max:22050,automatable:!0,type:n},Q:{value:1,min:.001,max:100,automatable:!0,type:n},gain:{value:0,min:-40,max:40,automatable:!0,type:n},bypass:{value:!1,automatable:!1,type:o},filterType:{value:"lowpass",automatable:!1,type:p}}},filterType:{enumerable:!0,get:function(){return this.filter.type},set:function(a){this.filter.type=a}},Q:{enumerable:!0,get:function(){return this.filter.Q},set:function(a){this.filter.Q.value=a}},gain:{enumerable:!0,get:function(){return this.filter.gain},set:function(a){this.filter.gain.value=a}},frequency:{enumerable:!0,get:function(){return this.filter.frequency},set:function(a){this.filter.frequency.value=a}}}),c.prototype.MoogFilter=function(a){a||(a=this.getDefaults()),this.bufferSize=a.bufferSize||this.defaults.bufferSize.value,this.input=j.createGain(),this.activateNode=j.createGain(),this.processor=j.createScriptProcessor(this.bufferSize,1,1),this.output=j.createGain(),this.activateNode.connect(this.processor),this.processor.connect(this.output);var b,c,d,e,f,g,h,k;b=c=d=e=f=g=h=k=0;var l,m,n,o,p,q;this.processor.onaudioprocess=function(a){for(l=a.inputBuffer.getChannelData(0),m=a.outputBuffer.getChannelData(0),n=1.16*this.cutoff,inputFactor=.35013*n*n*n*n,o=this.resonance*(1-.15*n*n),q=l.length,p=0;q>p;p++)l[p]-=k*o,l[p]*=inputFactor,f=l[p]+.3*b+(1-n)*f,b=l[p],g=f+.3*c+(1-n)*g,c=f,h=g+.3*d+(1-n)*h,d=g,k=h+.3*e+(1-n)*k,e=h,m[p]=k},this.cutoff=i(a.cutoff,this.defaults.cutoff.value),this.resonance=i(a.resonance,this.defaults.resonance.value),this.bypass=a.bypass||!1},c.prototype.MoogFilter.prototype=Object.create(m,{name:{value:"MoogFilter"},defaults:{writable:!0,value:{bufferSize:{value:4096,min:256,max:16384,automatable:!1,type:q},bypass:{value:!1,automatable:!1,type:o},cutoff:{value:.065,min:1e-4,max:1,automatable:!1,type:n},resonance:{value:3.5,min:0,max:4,automatable:!1,type:n}}},cutoff:{enumerable:!0,get:function(){return this.processor.cutoff},set:function(a){this.processor.cutoff=a}},resonance:{enumerable:!0,get:function(){return this.processor.resonance},set:function(a){this.processor.resonance=a}}}),c.prototype.Overdrive=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.inputDrive=j.createGain(),this.waveshaper=j.createWaveShaper(),this.outputDrive=j.createGain(),this.output=j.createGain(),this.activateNode.connect(this.inputDrive),this.inputDrive.connect(this.waveshaper),this.waveshaper.connect(this.outputDrive),this.outputDrive.connect(this.output),this.ws_table=new Float32Array(this.k_nSamples),this.drive=i(a.drive,this.defaults.drive.value),this.outputGain=i(a.outputGain,this.defaults.outputGain.value),this.curveAmount=i(a.curveAmount,this.defaults.curveAmount.value),this.algorithmIndex=i(a.algorithmIndex,this.defaults.algorithmIndex.value),this.bypass=a.bypass||!1},c.prototype.Overdrive.prototype=Object.create(m,{name:{value:"Overdrive"},defaults:{writable:!0,value:{drive:{value:1,min:0,max:1,automatable:!0,type:n,scaled:!0},outputGain:{value:1,min:0,max:1,automatable:!0,type:n,scaled:!0},curveAmount:{value:.725,min:0,max:1,automatable:!1,type:n},algorithmIndex:{value:0,min:0,max:5,automatable:!1,type:q}}},k_nSamples:{value:8192},drive:{get:function(){return this.inputDrive.gain},set:function(a){this._drive=a}},curveAmount:{get:function(){return this._curveAmount},set:function(a){this._curveAmount=a,void 0===this._algorithmIndex&&(this._algorithmIndex=0),this.waveshaperAlgorithms[this._algorithmIndex](this._curveAmount,this.k_nSamples,this.ws_table),this.waveshaper.curve=this.ws_table}},outputGain:{get:function(){return this.outputDrive.gain},set:function(a){this._outputGain=e(a)}},algorithmIndex:{get:function(){return this._algorithmIndex},set:function(a){this._algorithmIndex=a,this.curveAmount=this._curveAmount}},waveshaperAlgorithms:{value:[function(a,b,c){a=Math.min(a,.9999);var d,e,f=2*a/(1-a);for(d=0;b>d;d++)e=2*d/b-1,c[d]=(1+f)*e/(1+f*Math.abs(e))},function(a,b,c){var d,e,f;for(d=0;b>d;d++)e=2*d/b-1,f=(.5*Math.pow(e+1.4,2)-1)*f>=0?5.8:1.2,c[d]=h(f)},function(a,b,c){var d,e,f,g=1-a;for(d=0;b>d;d++)e=2*d/b-1,f=0>e?-Math.pow(Math.abs(e),g+.04):Math.pow(e,g),c[d]=h(2*f)},function(a,b,c){var d,e,f,h,i=1-a>.99?.99:1-a;for(d=0;b>d;d++)e=2*d/b-1,h=Math.abs(e),i>h?f=h:h>i?f=i+(h-i)/(1+Math.pow((h-i)/(1-i),2)):h>1&&(f=h),c[d]=g(e)*f*(1/((i+1)/2))},function(a,b,c){var d,e;for(d=0;b>d;d++)e=2*d/b-1,c[d]=-.08905>e?-3/4*(1-Math.pow(1-(Math.abs(e)-.032857),12)+1/3*(Math.abs(e)-.032847))+.01:e>=-.08905&&.320018>e?-6.153*e*e+3.9375*e:.630035},function(a,b,c){var d,e,f=2+Math.round(14*a),g=Math.round(Math.pow(2,f-1));for(d=0;b>d;d++)e=2*d/b-1,c[d]=Math.round(e*g)/g}]}}),c.prototype.Phaser=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.splitter=this.activateNode=j.createChannelSplitter(2),this.filtersL=[],this.filtersR=[],this.feedbackGainNodeL=j.createGain(),this.feedbackGainNodeR=j.createGain(),this.merger=j.createChannelMerger(2),this.filteredSignal=j.createGain(),this.output=j.createGain(),this.lfoL=new k.LFO({target:this.filtersL,callback:this.callback}),this.lfoR=new k.LFO({target:this.filtersR,callback:this.callback});for(var b=this.stage;b--;)this.filtersL[b]=j.createBiquadFilter(),this.filtersR[b]=j.createBiquadFilter(),this.filtersL[b].type="allpass",this.filtersR[b].type="allpass";this.input.connect(this.splitter),this.input.connect(this.output),this.splitter.connect(this.filtersL[0],0,0),this.splitter.connect(this.filtersR[0],1,0),this.connectInOrder(this.filtersL),this.connectInOrder(this.filtersR),this.filtersL[this.stage-1].connect(this.feedbackGainNodeL),this.filtersL[this.stage-1].connect(this.merger,0,0),this.filtersR[this.stage-1].connect(this.feedbackGainNodeR),this.filtersR[this.stage-1].connect(this.merger,0,1),this.feedbackGainNodeL.connect(this.filtersL[0]),this.feedbackGainNodeR.connect(this.filtersR[0]),this.merger.connect(this.output),this.rate=i(a.rate,this.defaults.rate.value),this.baseModulationFrequency=a.baseModulationFrequency||this.defaults.baseModulationFrequency.value,this.depth=i(a.depth,this.defaults.depth.value),this.feedback=i(a.feedback,this.defaults.feedback.value),this.stereoPhase=i(a.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=a.bypass||!1},c.prototype.Phaser.prototype=Object.create(m,{name:{value:"Phaser"},stage:{value:4},defaults:{writable:!0,value:{rate:{value:.1,min:0,max:8,automatable:!1,type:n},depth:{value:.6,min:0,max:1,automatable:!1,type:n},feedback:{value:.7,min:0,max:1,automatable:!1,type:n},stereoPhase:{value:40,min:0,max:180,automatable:!1,type:n},baseModulationFrequency:{value:700,min:500,max:1500,automatable:!1,type:n}}},callback:{value:function(a,b){for(var c=0;4>c;c++)a[c].frequency.value=b}},depth:{get:function(){return this._depth},set:function(a){this._depth=a,this.lfoL.oscillation=this._baseModulationFrequency*this._depth,this.lfoR.oscillation=this._baseModulationFrequency*this._depth}},rate:{get:function(){return this._rate},set:function(a){this._rate=a,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},baseModulationFrequency:{enumerable:!0,get:function(){return this._baseModulationFrequency},set:function(a){this._baseModulationFrequency=a,this.lfoL.offset=this._baseModulationFrequency,this.lfoR.offset=this._baseModulationFrequency,this._depth=this._depth}},feedback:{get:function(){return this._feedback},set:function(a){this._feedback=a,this.feedbackGainNodeL.gain.value=this._feedback,this.feedbackGainNodeR.gain.value=this._feedback}},stereoPhase:{get:function(){return this._stereoPhase},set:function(a){this._stereoPhase=a;var b=this.lfoL._phase+this._stereoPhase*Math.PI/180;b=f(b,2*Math.PI),this.lfoR._phase=b}}}),c.prototype.PingPongDelay=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.wetLevel=j.createGain(),this.stereoToMonoMix=j.createGain(),this.feedbackLevel=j.createGain(),this.output=j.createGain(),this.delayLeft=j.createDelay(),this.delayRight=j.createDelay(),this.activateNode=j.createGain(),this.splitter=j.createChannelSplitter(2),this.merger=j.createChannelMerger(2),this.activateNode.connect(this.splitter),this.splitter.connect(this.stereoToMonoMix,0,0),this.splitter.connect(this.stereoToMonoMix,1,0),this.stereoToMonoMix.gain.value=.5,this.stereoToMonoMix.connect(this.wetLevel),this.wetLevel.connect(this.delayLeft),this.feedbackLevel.connect(this.delayLeft),this.delayLeft.connect(this.delayRight),this.delayRight.connect(this.feedbackLevel),this.delayLeft.connect(this.merger,0,0),this.delayRight.connect(this.merger,0,1),this.merger.connect(this.output),this.activateNode.connect(this.output),this.delayTimeLeft=void 0!==a.delayTimeLeft?a.delayTimeLeft:this.defaults.delayTimeLeft.value,this.delayTimeRight=void 0!==a.delayTimeRight?a.delayTimeRight:this.defaults.delayTimeRight.value,this.feedbackLevel.gain.value=void 0!==a.feedback?a.feedback:this.defaults.feedback.value,this.wetLevel.gain.value=void 0!==a.wetLevel?a.wetLevel:this.defaults.wetLevel.value,this.bypass=a.bypass||!1},c.prototype.PingPongDelay.prototype=Object.create(m,{name:{value:"PingPongDelay"},delayTimeLeft:{enumerable:!0,get:function(){return this._delayTimeLeft},set:function(a){this._delayTimeLeft=a,this.delayLeft.delayTime.value=a/1e3}},delayTimeRight:{enumerable:!0,get:function(){return this._delayTimeRight},set:function(a){this._delayTimeRight=a,this.delayRight.delayTime.value=a/1e3}},defaults:{writable:!0,value:{delayTimeLeft:{value:200,min:1,max:1e4,automatable:!1,type:q},delayTimeRight:{value:400,min:1,max:1e4,automatable:!1,type:q},feedback:{value:.3,min:0,max:1,automatable:!1,type:n},wetLevel:{value:.5,min:0,max:1,automatable:!1,type:n}}}}),c.prototype.Tremolo=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.splitter=this.activateNode=j.createChannelSplitter(2),this.amplitudeL=j.createGain(),this.amplitudeR=j.createGain(),this.merger=j.createChannelMerger(2),this.output=j.createGain(),this.lfoL=new k.LFO({target:this.amplitudeL.gain,callback:l}),this.lfoR=new k.LFO({target:this.amplitudeR.gain,callback:l}),this.input.connect(this.splitter),this.splitter.connect(this.amplitudeL,0),this.splitter.connect(this.amplitudeR,1),this.amplitudeL.connect(this.merger,0,0),this.amplitudeR.connect(this.merger,0,1),this.merger.connect(this.output),this.rate=a.rate||this.defaults.rate.value,this.intensity=i(a.intensity,this.defaults.intensity.value),this.stereoPhase=i(a.stereoPhase,this.defaults.stereoPhase.value),this.lfoL.offset=1-this.intensity/2,this.lfoR.offset=1-this.intensity/2,this.lfoL.phase=this.stereoPhase*Math.PI/180,this.lfoL.activate(!0),this.lfoR.activate(!0),this.bypass=a.bypass||!1},c.prototype.Tremolo.prototype=Object.create(m,{name:{value:"Tremolo"},defaults:{writable:!0,value:{intensity:{value:.3,min:0,max:1,automatable:!1,type:n},stereoPhase:{value:0,min:0,max:180,automatable:!1,type:n},rate:{value:5,min:.1,max:11,automatable:!1,type:n}}},intensity:{enumerable:!0,get:function(){return this._intensity},set:function(a){this._intensity=a,this.lfoL.offset=1-this._intensity/2,this.lfoR.offset=1-this._intensity/2,this.lfoL.oscillation=this._intensity,this.lfoR.oscillation=this._intensity}},rate:{enumerable:!0,get:function(){return this._rate},set:function(a){this._rate=a,this.lfoL.frequency=this._rate,this.lfoR.frequency=this._rate}},stereoPhase:{enumerable:!0,get:function(){return this._rate},set:function(a){this._stereoPhase=a;var b=this.lfoL._phase+this._stereoPhase*Math.PI/180;b=f(b,2*Math.PI),this.lfoR.phase=b}}}),c.prototype.WahWah=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.activateNode=j.createGain(),this.envelopeFollower=new k.EnvelopeFollower({target:this,callback:function(a,b){a.sweep=b}}),this.filterBp=j.createBiquadFilter(),this.filterPeaking=j.createBiquadFilter(),this.output=j.createGain(),this.activateNode.connect(this.filterBp),this.filterBp.connect(this.filterPeaking),this.filterPeaking.connect(this.output),this.init(),this.automode=i(a.enableAutoMode,this.defaults.automode.value),this.resonance=a.resonance||this.defaults.resonance.value,this.sensitivity=i(a.sensitivity,this.defaults.sensitivity.value),this.baseFrequency=i(a.baseFrequency,this.defaults.baseFrequency.value),this.excursionOctaves=a.excursionOctaves||this.defaults.excursionOctaves.value,this.sweep=i(a.sweep,this.defaults.sweep.value),this.activateNode.gain.value=2,this.envelopeFollower.activate(!0),this.bypass=a.bypass||!1},c.prototype.WahWah.prototype=Object.create(m,{name:{value:"WahWah"},defaults:{writable:!0,value:{automode:{value:!0,automatable:!1,type:o},baseFrequency:{value:.5,min:0,max:1,automatable:!1,type:n},excursionOctaves:{value:2,min:1,max:6,automatable:!1,type:n},sweep:{value:.2,min:0,max:1,automatable:!1,type:n},resonance:{value:10,min:1,max:100,automatable:!1,type:n},sensitivity:{value:.5,min:-1,max:1,automatable:!1,type:n}}},activateCallback:{value:function(a){this.automode=a}},automode:{get:function(){return this._automode},set:function(a){this._automode=a,a?(this.activateNode.connect(this.envelopeFollower.input),this.envelopeFollower.activate(!0)):(this.envelopeFollower.activate(!1),this.activateNode.disconnect(),this.activateNode.connect(this.filterBp))}},filterFreqTimeout:{value:0},setFilterFreq:{value:function(){try{this.filterBp.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep,this.filterPeaking.frequency.value=this._baseFrequency+this._excursionFrequency*this._sweep}catch(a){clearTimeout(this.filterFreqTimeout),this.filterFreqTimeout=setTimeout(function(){this.setFilterFreq()}.bind(this),0)}}},sweep:{enumerable:!0,get:function(){return this._sweep.value},set:function(a){this._sweep=Math.pow(a>1?1:0>a?0:a,this._sensitivity),this.setFilterFreq()}},baseFrequency:{enumerable:!0,get:function(){return this._baseFrequency},set:function(a){this._baseFrequency=50*Math.pow(10,2*a),this._excursionFrequency=Math.min(j.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},excursionOctaves:{enumerable:!0,get:function(){return this._excursionOctaves},set:function(a){this._excursionOctaves=a,this._excursionFrequency=Math.min(j.sampleRate/2,this.baseFrequency*Math.pow(2,this._excursionOctaves)),this.setFilterFreq()}},sensitivity:{enumerable:!0,get:function(){return this._sensitivity},set:function(a){this._sensitivity=Math.pow(10,a)}},resonance:{enumerable:!0,get:function(){return this._resonance},set:function(a){this._resonance=a,this.filterPeaking.Q=this._resonance}},init:{value:function(){this.output.gain.value=1,this.filterPeaking.type="peaking",this.filterBp.type="bandpass",this.filterPeaking.frequency.value=100,this.filterPeaking.gain.value=20,this.filterPeaking.Q.value=5,this.filterBp.frequency.value=100,this.filterBp.Q.value=1}}}),c.prototype.EnvelopeFollower=function(a){a||(a=this.getDefaults()),this.input=j.createGain(),this.jsNode=this.output=j.createScriptProcessor(this.buffersize,1,1),this.input.connect(this.output),this.attackTime=i(a.attackTime,this.defaults.attackTime.value),this.releaseTime=i(a.releaseTime,this.defaults.releaseTime.value),this._envelope=0,this.target=a.target||{},this.callback=a.callback||function(){}},c.prototype.EnvelopeFollower.prototype=Object.create(m,{name:{value:"EnvelopeFollower"},defaults:{value:{attackTime:{value:.003,min:0,max:.5,automatable:!1,type:n},releaseTime:{value:.5,min:0,max:.5,automatable:!1,type:n}}},buffersize:{value:256},envelope:{value:0},sampleRate:{value:44100},attackTime:{enumerable:!0,get:function(){return this._attackTime},set:function(a){this._attackTime=a,this._attackC=Math.exp(-1/this._attackTime*this.sampleRate/this.buffersize)}},releaseTime:{enumerable:!0,get:function(){return this._releaseTime},set:function(a){this._releaseTime=a,this._releaseC=Math.exp(-1/this._releaseTime*this.sampleRate/this.buffersize)}},callback:{get:function(){return this._callback},set:function(a){"function"==typeof a?this._callback=a:console.error("tuna.js: "+this.name+": Callback must be a function!")}},target:{get:function(){return this._target},set:function(a){this._target=a}},activate:{value:function(a){this.activated=a,a?(this.jsNode.connect(j.destination),this.jsNode.onaudioprocess=this.returnCompute(this)):(this.jsNode.disconnect(),this.jsNode.onaudioprocess=null)}},returnCompute:{value:function(a){return function(b){a.compute(b)
}}},compute:{value:function(a){var b,c,d,e,f=a.inputBuffer.getChannelData(0).length,g=a.inputBuffer.numberOfChannels;if(c=d=e=0,g>1)for(e=0;f>e;++e)for(;g>c;++c)b=a.inputBuffer.getChannelData(c)[e],d+=b*b/g;else for(e=0;f>e;++e)b=a.inputBuffer.getChannelData(0)[e],d+=b*b;d=Math.sqrt(d),this._envelope<d?(this._envelope*=this._attackC,this._envelope+=(1-this._attackC)*d):(this._envelope*=this._releaseC,this._envelope+=(1-this._releaseC)*d),this._callback(this._target,this._envelope)}}}),c.prototype.LFO=function(a){this.output=j.createScriptProcessor(256,1,1),this.activateNode=j.destination,this.frequency=i(a.frequency,this.defaults.frequency.value),this.offset=i(a.offset,this.defaults.offset.value),this.oscillation=i(a.oscillation,this.defaults.oscillation.value),this.phase=i(a.phase,this.defaults.phase.value),this.target=a.target||{},this.output.onaudioprocess=this.callback(a.callback||function(){}),this.bypass=a.bypass||!1},c.prototype.LFO.prototype=Object.create(m,{name:{value:"LFO"},bufferSize:{value:256},sampleRate:{value:44100},defaults:{value:{frequency:{value:1,min:0,max:20,automatable:!1,type:n},offset:{value:.85,min:0,max:22049,automatable:!1,type:n},oscillation:{value:.3,min:-22050,max:22050,automatable:!1,type:n},phase:{value:0,min:0,max:2*Math.PI,automatable:!1,type:n}}},frequency:{get:function(){return this._frequency},set:function(a){this._frequency=a,this._phaseInc=2*Math.PI*this._frequency*this.bufferSize/this.sampleRate}},offset:{get:function(){return this._offset},set:function(a){this._offset=a}},oscillation:{get:function(){return this._oscillation},set:function(a){this._oscillation=a}},phase:{get:function(){return this._phase},set:function(a){this._phase=a}},target:{get:function(){return this._target},set:function(a){this._target=a}},activate:{value:function(a){a?this.output.connect(j.destination):this.output.disconnect(j.destination)}},callback:{value:function(a){var b=this;return function(){b._phase+=b._phaseInc,b._phase>2*Math.PI&&(b._phase=0),a(b._target,b._offset+b._oscillation*Math.sin(b._phase))}}}}),c.toString=c.prototype.toString=function(){return"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js"}}(this);var a=window.AudioContext||window.webkitAudioContext,b=new a;getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.getUserMedia,getUserMedia?getUserMedia=getUserMedia.bind(navigator):console.log("get user media is not supported");var c=function(){function a(a,b){var c=4,d=1e3,e=1e3,f=-1,g=0,h=0,i=!1;if(a.length<e+d-c)return-1;for(var j=0;e>j;j++){var k=(a[j]-128)/128;h+=k*k}if(h=Math.sqrt(h/e),.01>h)return-1;for(var l=1,m=c;d>=m;m++){for(var n=0,j=0;e>j;j++)n+=Math.abs((a[j]-128)/128-(a[j+m]-128)/128);if(n=1-n/e,n>.9&&n>l)i=!0;else if(i)return b/f;l=n,n>g&&(g=n,f=m)}return g>.01?b/f:-1}var c=function(){Math.seed=6,Math.seededRandom=function(a,b){a=a||1,b=b||0,Math.seed=(9301*Math.seed+49297)%233280;var c=Math.seed/233280;return b+c*(a-b)};for(var a=2*b.sampleRate,c=b.createBuffer(1,a,b.sampleRate),d=c.getChannelData(0),e=0;a>e;e++)d[e]=2*Math.seededRandom()-1;return c}(),d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=function(a,b){a.env={attack:b.env?G(b.env.attack,1):0,decay:b.env?G(b.env.decay,0):0,sustain:b.env?G(b.env.sustain,1):1,hold:b.env?G(b.env.hold,3.14):3.14,release:b.env?G(b.env.release,0):0},a.defaultEnv={attack:b.env?G(b.env.attack,1):0,decay:b.env?G(b.env.decay,0):0,sustain:b.env?G(b.env.sustain,1):1,hold:b.env?G(b.env.hold,3.14):3.14,release:b.env?G(b.env.release,0):0}},f=function(a,b){b.filter?a.filter=d(b.filter)?b.filter.map(function(a){return{type:a.type||"lowpass",frequency:a.frequency||600,q:a.q||1,env:a.env||null}}):[{type:b.filter.type||"lowpass",frequency:b.filter.frequency||600,q:b.filter.q||1,env:b.filter.env||null}]:b.filter=null},g=function(a,c){var d=new XMLHttpRequest;d.open("GET",a.source,!0),d.responseType="arraybuffer",a.playable--,d.onload=function(){b.decodeAudioData(d.response,function(b){a.decodedBuffer=b,c&&c(a),a.playable++,a.playOnLoad&&a.play(a.playOnLoadArg)})},d.send()},h=function(a,b){a.vibrato=b.vibrato?{shape:G(b.vibrato.shape,"sine"),speed:G(b.vibrato.speed,1),magnitude:G(b.vibrato.magnitude,5),attack:G(b.vibrato.attack,0)}:null},i=function(a,b){a.tremolo=b.tremolo?{shape:G(b.tremolo.shape,"sine"),speed:G(b.tremolo.speed,1),magnitude:G(b.tremolo.magnitude,5),attack:G(b.tremolo.attack,1)}:null},j=function(a,c){if(c.reverb){a.reverb={wet:G(c.reverb.wet,1)};var d=c.reverb.impulse||o.defaultImpulse,e=new XMLHttpRequest;e.open("GET",d,!0),e.responseType="arraybuffer",a.playable--,e.onload=function(){b.decodeAudioData(e.response,function(b){a.reverb.buffer=b,a.playable++,a.playOnLoad&&a.play(a.playOnLoadArg),a instanceof o.Poly&&a.setUp(c),"mic"===a.source&&a.reverb&&a.reverb.buffer&&a.reverb.node&&!a.reverb.node.buffer&&(a.reverb.node.convolver.buffer=a.reverb.buffer)})},e.send()}else a.reverb=null},k=function(a,c){"panning"in c?(a.panning={location:c.panning},"number"==typeof c.panning?a.panning.type="stereo":(a.panning.type="3d",a.panning.panningModel=c.panningModel||"equalpower")):a.panning={location:0,type:"stereo"},"stereo"!==a.panning.type||b.createStereoPanner||(console.log("Your browser does not support stereo panning. Falling back to 3D panning."),a.panning={location:[0,0,0],type:"3d",panningModel:"equalpower"})},l=function(a,b){a.delay=b.delay?{delayTime:G(b.delay.delayTime,.5),maxDelayTime:G(b.delay.maxDelayTime,2),feedback:G(b.delay.feedback,.25),wet:G(b.delay.wet,.25)}:null},m=function(a,c){a.nodes=[],a.mediaStreamSource=null,a.gain=null,getUserMedia({audio:!0,video:!1},function(d){a.mediaStreamSource=b.createMediaStreamSource(d),o.micConsent=!0,n(a,c)},function(a){console.log("Error setting up microphone input: ",a)})},n=function(a,c){a.nodes=[],a.gain=b.createGain(),a.gain.gain.value=G(c.volume,a.volume),a.nodes.push(a.mediaStreamSource),a.nodes.push(a.gain),(a.filter||c.filter)&&u(a,c),(a.reverb||c.reverb)&&w(a,c),k(a,c),x(a,c),(a.delay||c.delay)&&A(a,c),C(a,c),a.setUpExternalFxOnPlay(c,b)},o=function(a){if(this.source=a.source,this.destination=a.destination||b.destination,this.volume=G(a.volume,1),this.defaultVolume=this.volume,this.playable=1,this.pitch=o.pitches[a.pitch]||a.pitch||440,this.detune=a.detune||0,this.globalReverb=a.globalReverb||!1,this.gain=[],this.loop=a.loop||!1,this.tuna=a.tuna||null,e(this,a),f(this,a),h(this,a),i(this,a),j(this,a),this.constructExternalFx(a,b),k(this,a),l(this,a),"noise"===this.source)this.decodedBuffer=c;else if("mic"===this.source)m(this,a);else if("object"==typeof this.source){var d=b.createBuffer(2,this.source[0].length,b.sampleRate);d.getChannelData(0).set(this.source[0]),d.getChannelData(1).set(this.source[1]),this.decodedBuffer=d}else this.source in{sine:0,sawtooth:0,square:0,triangle:0}?a.callback&&a.callback(this):g(this,a.callback)};o.micConsent=!1,o.audioContext=b,void 0!=window.Tuna&&(o.tuna=new Tuna(o.audioContext));var p=function(a,b){a.filter.forEach(function(a){a.node.frequency.linearRampToValueAtTime(a.frequency,b.exactTime),a.node.frequency.linearRampToValueAtTime(a.env.frequency,b.exactTime+a.env.attack)})},q=function(a,b){a.gain[0].gain.linearRampToValueAtTime(1e-4,b.exactTime),a.gain[0].gain.linearRampToValueAtTime(a.volume,b.exactTime+a.env.attack+1e-5),a.gain[0].gain.linearRampToValueAtTime(a.volume*a.env.sustain,b.exactTime+a.env.attack+a.env.decay+2e-5),a.gain[0].gain.linearRampToValueAtTime(a.volume*a.env.sustain,b.exactTime+a.env.attack+a.env.decay+a.env.hold+3e-5),a.gain[0].gain.linearRampToValueAtTime(1e-4,b.exactTime+a.env.attack+a.env.decay+a.env.hold+a.env.release+4e-5),a.soundSource.start(b.exactTime),a.soundSource.stop(b.exactTime+a.env.attack+a.env.decay+a.env.hold+a.env.release)},r=function(a,b){for(var c=b&&b.destination||a.destination,d=1;d<a.nodes.length;d++){if("custom"===a.nodes[d-1].interface)var e=a.nodes[d-1].output;else var e=a.nodes[d-1];if("custom"===a.nodes[d].interface)var f=a.nodes[d].input;else var f=a.nodes[d];e.connect(f)}if("custom"===a.nodes[a.nodes.length-1].interface)var g=a.nodes[a.nodes.length-1].output;else var g=a.nodes[a.nodes.length-1];g.connect(c),o.reverb&&a.globalReverb&&(a.nodes[a.nodes.length-1].connect(o.reverb.node),o.reverb.node.connect(o.reverb.gain),o.reverb.gain.connect(c))},s=function(a,c){c=c||{},a.soundSource=b.createOscillator(),a.soundSource.type=a.source,a.soundSource.frequency.value=c.pitch?c.pitch in o.pitches?o.pitches[c.pitch]:c.pitch:a.pitch,a.soundSource.detune.value=c.detune||a.detune},t=function(a,b){b&&b.env?(a.env.attack=G(b.env.attack,a.defaultEnv.attack),a.env.decay=G(b.env.decay,a.defaultEnv.decay),a.env.sustain=G(b.env.sustain,a.defaultEnv.sustain),a.env.hold=G(b.env.hold,a.defaultEnv.hold),a.env.release=G(b.env.release,a.defaultEnv.release)):a.env={attack:a.defaultEnv.attack,decay:a.defaultEnv.decay,sustain:a.defaultEnv.sustain,hold:a.defaultEnv.hold,release:a.defaultEnv.release}},u=function(a,c){c.filter&&!d(c.filter)&&(c.filter=[c.filter]),a.filter.forEach(function(d,e){d.node=b.createBiquadFilter(),d.node.type=d.type,d.node.frequency.value=c.filter&&c.filter[e]?c.filter[e].frequency||d.frequency:d.frequency,d.node.Q.value=c.filter&&c.filter[e]?c.filter[e].q||d.q:d.q,(c.filter&&c.filter[e].env||a.filter[e].env)&&"mic"!==a.source&&(d.env={attack:c.filter&&c.filter[e].env&&c.filter[e].env.attack||a.filter[e].env.attack,frequency:c.filter&&c.filter[e].env&&c.filter[e].env.frequency||a.filter[e].env.frequency}),a.nodes.push(d.node)})},v=function(a,b){b&&b.filter&&a.filter?(d(b.filter)||(b.filter=[b.filter]),u(a,b)):a.filter&&u(a,a)},w=function(a){var c={"interface":"custom",input:b.createGain(),convolver:b.createConvolver(),wet:b.createGain(),output:b.createGain()};c.convolver.buffer=a.reverb.buffer,c.wet.gain.value=a.reverb.wet,c.input.connect(c.convolver),c.input.connect(c.output),c.convolver.connect(c.wet),c.wet.connect(c.output),a.reverb.node=c,a.nodes.push(a.reverb.node)},x=function(a,c){var d=c&&c.panning;"undefined"==typeof d&&(d=a.panning.location),"number"==typeof d?(a.panning.node=b.createStereoPanner(),a.panning.node.pan.value=d,a.panning.type="stereo"):(a.panning.node=b.createPanner(),a.panning.node.setPosition(d[0],d[1],d[2]),a.panning.node.panningModel=c.panningModel||a.panningModel||"equalpower",a.panning.type="3d"),a.nodes.push(a.panning.node)},y=function(a){a.vibrato.wad=new o({source:a.vibrato.shape,pitch:a.vibrato.speed,volume:a.vibrato.magnitude,env:{attack:a.vibrato.attack},destination:a.soundSource.frequency}),a.vibrato.wad.play()},z=function(a){a.tremolo.wad=new o({source:a.tremolo.shape,pitch:a.tremolo.speed,volume:a.tremolo.magnitude,env:{attack:a.tremolo.attack,hold:10},destination:a.gain[0].gain}),a.tremolo.wad.play()},A=function(a,c){if(a.delay){c.delay||(c.delay={});var d={"interface":"custom",input:b.createGain(),output:b.createGain(),delayNode:b.createDelay(a.delay.maxDelayTime),feedbackNode:b.createGain(),wetNode:b.createGain()};d.delayNode.delayTime.value=G(c.delay.delayTime,a.delay.delayTime),d.feedbackNode.gain.value=G(c.delay.feedback,a.delay.feedback),d.wetNode.gain.value=G(c.delay.wet,a.delay.wet),d.input.connect(d.delayNode),d.input.connect(d.output),d.delayNode.connect(d.feedbackNode),d.delayNode.connect(d.wetNode),d.feedbackNode.connect(d.delayNode),d.wetNode.connect(d.output),a.delay.delayNode=d,a.nodes.push(d)}},B=function(a,c){a.compressor=b.createDynamicsCompressor(),a.compressor.attack.value=G(c.compressor.attack,a.compressor.attack.value),a.compressor.knee.value=G(c.compressor.knee,a.compressor.knee.value),a.compressor.ratio.value=G(c.compressor.ratio,a.compressor.ratio.value),a.compressor.release.value=G(c.compressor.release,a.compressor.release.value),a.compressor.threshold.value=G(c.compressor.threshold,a.compressor.threshold.value),a.nodes.push(a.compressor)},C=function(a,b){if(a.tuna||b.tuna){var c={};if(a.tuna)for(var d in a.tuna)c[d]=a.tuna[d];if(b.tuna)for(var d in b.tuna)c[d]=b.tuna[d];console.log("tunaconfig: ",c);for(var d in c){console.log(d);var e=new o.tuna[d](c[d]);a.nodes.push(e)}}};o.prototype.constructExternalFx=function(){},o.prototype.setUpExternalFxOnPlay=function(){},o.prototype.play=function(a){return a=a||{arg:null},this.playable<1?(this.playOnLoad=!0,this.playOnLoadArg=a):"mic"===this.source?o.micConsent?null===a.arg?r(this,a):(f(this,a),h(this,a),i(this,a),j(this,a),this.constructExternalFx(a,b),k(this,a),l(this,a),n(this,a),r(this,a)):console.log("You have not given your browser permission to use your microphone."):(this.nodes=[],a.wait||(a.wait=0),this.volume=a.volume?a.volume:this.defaultVolume,this.source in{sine:0,sawtooth:0,square:0,triangle:0}?s(this,a):(this.soundSource=b.createBufferSource(),this.soundSource.buffer=this.decodedBuffer,("noise"===this.source||this.loop||a.loop)&&(this.soundSource.loop=!0)),void 0===a.exactTime&&(a.exactTime=b.currentTime+a.wait),this.nodes.push(this.soundSource),t(this,a),v(this,a),C(this,a),this.setUpExternalFxOnPlay(a,b),this.gain.unshift(b.createGain()),this.gain[0].label=a.label,this.nodes.push(this.gain[0]),this.gain.length>15&&(this.gain.length=15),this.reverb&&w(this,a),x(this,a),A(this,a),r(this,a),this.filter&&this.filter[0].env&&p(this,a),q(this,a),this.vibrato&&y(this,a),this.tremolo&&z(this,a)),a.callback&&a.callback(this),this},o.prototype.setVolume=function(a){return this.defaultVolume=a,this.gain.length>0&&(this.gain[0].gain.value=a),this},o.prototype.setDetune=function(a){return this.soundSource.detune.value=a,this},o.prototype.setPanning=function(a){return this.panning.location=a,d(a)&&"3d"===this.panning.type&&this.panning.node?this.panning.node.setPosition(a[0],a[1],a[2]):"number"==typeof a&&"stereo"===this.panning.type&&this.panning.node&&(this.panning.node.pan.value=a),d(a)?this.panning.type="3d":"number"==typeof a&&(this.panning.type="stereo"),this},o.prototype.stop=function(a){if("mic"!==this.source){if(a)for(var c=0;c<this.gain.length;c++)this.gain[c].label===a&&(this.gain[c].gain.cancelScheduledValues(b.currentTime),this.gain[c].gain.setValueAtTime(this.gain[c].gain.value,b.currentTime),this.gain[c].gain.linearRampToValueAtTime(1e-4,b.currentTime+this.env.release));a||(this.gain[0].gain.cancelScheduledValues(b.currentTime),this.gain[0].gain.setValueAtTime(this.gain[0].gain.value,b.currentTime),this.gain[0].gain.linearRampToValueAtTime(1e-4,b.currentTime+this.env.release))}else o.micConsent?this.mediaStreamSource.disconnect(0):console.log("You have not given your browser permission to use your microphone.");this.tremolo&&this.tremolo.wad.stop()};var D=2048,E=new Uint8Array(D),F=function(a){var b=12*(Math.log(a/440)/Math.log(2));return Math.round(b)+69};o.Poly=function(a){a||(a={}),this.isSetUp=!1,this.playable=1,a.reverb?j(this,a):this.setUp(a)},o.Poly.prototype.setUp=function(a){if(this.wads=[],this.input=b.createAnalyser(),this.input.fftSize=2048,this.nodes=[this.input],this.destination=a.destination||b.destination,this.volume=a.volume||1,this.output=b.createGain(),this.output.gain.value=this.volume,this.tuna=a.tuna||null,"undefined"!=typeof Recorder&&a.recConfig){this.rec=new Recorder(this.output,a.recConfig),this.rec.recordings=[];var c=this,d=function(a){c.rec.createWadArg.source=a,c.rec.recordings.unshift(new o(c.rec.createWadArg))};this.rec.createWad=function(a){this.createWadArg=a||{env:{hold:9001}},this.getBuffer(d)}}this.globalReverb=a.globalReverb||!1,f(this,a),this.filter&&u(this,a),this.reverb&&w(this,a),this.constructExternalFx(a,b),k(this,a),x(this,a),a.compressor&&B(this,a),l(this,a),A(this,a),C(this,a),this.nodes.push(this.output),r(this,a),this.isSetUp=!0,a.callback&&a.callback(this)},o.Poly.prototype.updatePitch=function(){this.input.getByteTimeDomainData(E);var c=a(E,b.sampleRate);if(-1!==c&&11025!==c&&12e3!==c){var d=c;this.pitch=Math.floor(d);var e=F(d);this.noteName=o.pitchesArray[e-12]}var f=this;f.rafID=window.requestAnimationFrame(function(){f.updatePitch()})},o.Poly.prototype.stopUpdatingPitch=function(){cancelAnimationFrame(this.rafID)},o.Poly.prototype.setVolume=function(a){return this.isSetUp?this.output.gain.value=a:console.log("This PolyWad is not set up yet."),this},o.Poly.prototype.play=function(a){if(this.isSetUp)if(this.playable<1)this.playOnLoad=!0,this.playOnLoadArg=a;else{a&&a.volume&&(this.output.gain.value=a.volume,a.volume=void 0);for(var b=0;b<this.wads.length;b++)this.wads[b].play(a)}else console.log("This PolyWad is not set up yet.");return this},o.Poly.prototype.stop=function(a){if(this.isSetUp)for(var b=0;b<this.wads.length;b++)this.wads[b].stop(a)},o.Poly.prototype.add=function(a){return this.isSetUp?(a.destination=this.input,this.wads.push(a),a instanceof o.Poly&&(a.output.disconnect(0),a.output.connect(this.input))):console.log("This PolyWad is not set up yet."),this},o.Poly.prototype.remove=function(a){if(this.isSetUp)for(var c=0;c<this.wads.length;c++)this.wads[c]===a&&(this.wads[c].destination=b.destination,this.wads.splice(c,1),a instanceof o.Poly&&(a.output.disconnect(0),a.output.connect(b.destination)));return this},o.Poly.prototype.constructExternalFx=function(){},o.defaultImpulse="http://www.codecur.io/us/sendaudio/widehall.wav",o.setGlobalReverb=function(a){o.reverb={},o.reverb.node=b.createConvolver(),o.reverb.gain=b.createGain(),o.reverb.gain.gain.value=a.wet;var c=a.impulse||o.defaultImpulse,d=new XMLHttpRequest;d.open("GET",c,!0),d.responseType="arraybuffer",d.onload=function(){b.decodeAudioData(d.response,function(a){o.reverb.node.buffer=a})},d.send()};var G=function(a,b){var c=null==a?b:a;return c};o.pitches={A0:27.5,"A#0":29.1352,Bb0:29.1352,B0:30.8677,"B#0":32.7032,Cb1:30.8677,C1:32.7032,"C#1":34.6478,Db1:34.6478,D1:36.7081,"D#1":38.8909,Eb1:38.8909,E1:41.2034,Fb1:41.2034,"E#1":43.6535,F1:43.6535,"F#1":46.2493,Gb1:46.2493,G1:48.9994,"G#1":51.9131,Ab1:51.9131,A1:55,"A#1":58.2705,Bb1:58.2705,B1:61.7354,Cb2:61.7354,"B#1":65.4064,C2:65.4064,"C#2":69.2957,Db2:69.2957,D2:73.4162,"D#2":77.7817,Eb2:77.7817,E2:82.4069,Fb2:82.4069,"E#2":87.3071,F2:87.3071,"F#2":92.4986,Gb2:92.4986,G2:97.9989,"G#2":103.826,Ab2:103.826,A2:110,"A#2":116.541,Bb2:116.541,B2:123.471,Cb3:123.471,"B#2":130.813,C3:130.813,"C#3":138.591,Db3:138.591,D3:146.832,"D#3":155.563,Eb3:155.563,E3:164.814,Fb3:164.814,"E#3":174.614,F3:174.614,"F#3":184.997,Gb3:184.997,G3:195.998,"G#3":207.652,Ab3:207.652,A3:220,"A#3":233.082,Bb3:233.082,B3:246.942,Cb4:246.942,"B#3":261.626,C4:261.626,"C#4":277.183,Db4:277.183,D4:293.665,"D#4":311.127,Eb4:311.127,E4:329.628,Fb4:329.628,"E#4":349.228,F4:349.228,"F#4":369.994,Gb4:369.994,G4:391.995,"G#4":415.305,Ab4:415.305,A4:440,"A#4":466.164,Bb4:466.164,B4:493.883,Cb5:493.883,"B#4":523.251,C5:523.251,"C#5":554.365,Db5:554.365,D5:587.33,"D#5":622.254,Eb5:622.254,E5:659.255,Fb5:659.255,"E#5":698.456,F5:698.456,"F#5":739.989,Gb5:739.989,G5:783.991,"G#5":830.609,Ab5:830.609,A5:880,"A#5":932.328,Bb5:932.328,B5:987.767,Cb6:987.767,"B#5":1046.5,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,Fb6:1318.51,E6:1318.51,"E#6":1396.91,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,Cb7:1975.53,"B#6":2093,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,Fb7:2637.02,"E#7":2793.83,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,Cb8:3951.07,"B#7":4186.01,C8:4186.01},o.pitchesArray=["C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8"],o.midiInstrument={play:function(){console.log("playing midi")},stop:function(){console.log("stopping midi")}},o.midiInputs=[],midiMap=function(a){console.log(a.receivedTime,a.data),144===a.data[0]?0===a.data[2]?(console.log("|| stopping note: ",o.pitchesArray[a.data[1]-12]),o.midiInstrument.stop(o.pitchesArray[a.data[1]-12])):a.data[2]>0&&(console.log("> playing note: ",o.pitchesArray[a.data[1]-12]),o.midiInstrument.play({pitch:o.pitchesArray[a.data[1]-12],label:o.pitchesArray[a.data[1]-12],callback:function(){}})):176===a.data[0]?(console.log("controller"),46==a.data[1]&&(127==a.data[2]?o.midiInstrument.pedalMod=!0:0==a.data[2]&&(o.midiInstrument.pedalMod=!1))):224===a.data[0]&&console.log("pitch bend")};var H=function(a){o.midiInputs=[];for(var b=a.inputs.values(),c=b.next();!c.done;c=b.next())o.midiInputs.push(c.value);console.log("MIDI inputs: ",o.midiInputs);for(var d=0;d<o.midiInputs.length;d++)o.midiInputs[d].onmidimessage=midiMap},I=function(a){console.log("uh-oh! Something went wrong!  Error code: "+a.code)};if(navigator&&navigator.requestMIDIAccess)try{navigator.requestMIDIAccess().then(H,I)}catch(J){var K="There was an error on this page.\n\n";K+="Error description: "+J.message+"\n\n",K+="Click OK to continue.\n\n",console.log(K)}return o.presets={hiHatClosed:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.03,release:.01},filter:{type:"highpass",frequency:400,q:1}},snare:{source:"noise",env:{attack:.001,decay:.01,sustain:.2,hold:.03,release:.02},filter:{type:"bandpass",frequency:300,q:.18}},hiHatOpen:{source:"noise",env:{attack:.001,decay:.008,sustain:.2,hold:.43,release:.01},filter:{type:"highpass",frequency:100,q:.2}},ghost:{source:"square",volume:.3,env:{attack:.01,decay:.002,sustain:.5,hold:2.5,release:.3},filter:{type:"lowpass",frequency:600,q:7,env:{attack:.7,frequency:1600}},vibrato:{attack:8,speed:8,magnitude:100}},piano:{source:"square",volume:1.4,env:{attack:.01,decay:.005,sustain:.2,hold:.015,release:.3},filter:{type:"lowpass",frequency:1200,q:8.5,env:{attack:.2,frequency:600}}}},o}();return"undefined"!=typeof module&&module.exports&&(module.exports=c),c});